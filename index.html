<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>¬øQu√© Prefieres?</title>

<link href="https://fonts.googleapis.com/css2?family=Fjalla+One&family=Lilita+One&family=Lobster&family=Roboto:wght@700&family=Viga&family=Inter&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  background:#3c1361;
  font-family:'Viga', sans-serif;
  color:white;
}

.container {
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
}

button {
  padding:15px 30px;
  border:none;
  border-radius:12px;
  font-size:20px;
  cursor:pointer;
}

#btnJugar {background:white;color:#00ff00;font-family:'Lobster'}
#btnReglas {background:black;color:red;font-family:'Fjalla One'}
#btnCrear {background:yellow;color:blue;font-family:'Lilita One'}

#gameScreen {
  display:none;
  height:100vh;
  position:relative;
}

.option {
  height:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:32px;
  cursor:pointer;
}

.blue {background:#1e90ff}
.red {background:#ff4136}

.skip {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:black;
  padding:10px 20px;
  border-radius:40px;
}

#userCounter {
  position:absolute;
  top:10px;
  left:10px;
  font-size:14px;
}

#rulesScreen {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:flex;
  justify-content:center;
  align-items:center;
}

.rulesBox {
  width:80%;
  max-width:400px;
  height:400px;
  background:red;
  padding:20px;
  overflow-y:auto;
  border-radius:15px;
}

.confirm {color:green;text-decoration:underline}

#closeRules {
  margin-top:15px;
  background:black;
  color:white;
}

#createScreen {
  display:none;
  height:100vh;
  background:linear-gradient(#5e2b97,#ffd500);
  padding:20px;
}

.create-input {
  width:100%;
  padding:12px;
  margin-bottom:15px;
  font-size:18px;
  border-radius:8px;
}

#endScreen {
  display:none;
  background:black;
  height:100vh;
  overflow:hidden;
  position:relative;
}

.led {
  position:absolute;
  top:45%;
  white-space:nowrap;
  font-size:28px;
  animation:scroll 6s linear infinite;
}

@keyframes scroll {
  from {left:-100%}
  to {left:100%}
}

.backBtn {
  position:absolute;
  bottom:40px;
  left:20px;
  font-size:40px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container" id="mainMenu">
  <button id="btnJugar">Jugar üéÆ</button>
  <button id="btnReglas">Reglas De Creaci√≥n üìê</button>
  <button id="btnCrear">Crear Pregunta ‚ùì</button>
</div>

<div id="gameScreen">
  <div id="userCounter"></div>
  <div id="opt1" class="option blue"></div>
  <div class="skip" id="skipBtn">SKIP</div>
  <div id="opt2" class="option red"></div>
</div>

<div id="rulesScreen">
  <div class="rulesBox">
    <p>üìè REGLAS:</p>
    <p>1- Nada NSFW o Gore üö´</p>
    <p>2- No herir personas ‚ùå</p>
    <p>3- S√© creativo üòé</p>
    <p>4- Toc√° <span class="confirm">CONFIRMAR</span> ‚úÖ</p>
    <button id="closeRules">Cerrar</button>
  </div>
</div>

<div id="createScreen">
  <input class="create-input" id="qText" placeholder="Elige la Pregunta">
  <input class="create-input" id="aText" placeholder="Elige 1ra Opci√≥n">
  <input class="create-input" id="bText" placeholder="Elige 2da Opci√≥n">
  <button id="createBtn">CREAR! ‚ú®</button>
</div>

<div id="endScreen">
  <div class="led">¬°WOW! PARECE QUE HAS LLEGADO HASTA AL FINAL</div>
  <div class="backBtn" id="backMenu">‚¨ÖÔ∏è</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyD7m0bN8P71AhnmK6zscd389eaTEUyeRcc",
  authDomain:"queprefieresapp.firebaseapp.com",
  databaseURL:"https://queprefieresapp-default-rtdb.firebaseio.com",
  projectId:"queprefieresapp"
});

const db=firebase.database();
const userRef=db.ref("usuarios");
userRef.transaction(v=>(v||0)+1);
userRef.on("value",s=>userCounter.innerText="Usuarios: "+s.val());

let questions=[], used=[], index=0, loops=0;

db.ref("preguntas").on("value",snap=>{
  questions=[];
  snap.forEach(c=>{
    questions.push({id:c.key,...c.val()});
  });
});

btnJugar.onclick=()=>{
  used=[];
  index=0;
  mainMenu.style.display="none";
  gameScreen.style.display="block";
  nextQ();
};

function nextQ(){
  if(used.length===questions.length){
    gameScreen.style.display="none";
    endScreen.style.display="block";
    loops++;
    if(loops>=5){
      document.querySelector(".led").style.animation="none";
    }
    return;
  }

  let q;
  do{
    q=questions[Math.floor(Math.random()*questions.length)];
  }while(used.includes(q.id));

  used.push(q.id);
  current=q;
  opt1.innerText=q.a;
  opt2.innerText=q.b;
}

opt1.onclick=()=>vote("a");
opt2.onclick=()=>vote("b");
skipBtn.onclick=nextQ;

function vote(c){
  const ref=db.ref("preguntas/"+current.id+"/votes");
  ref.transaction(v=>{
    v=v||{a:0,b:0};
    v[c]++;
    return v;
  });
  setTimeout(nextQ,700);
}

btnReglas.onclick=()=>rulesScreen.style.display="flex";
closeRules.onclick=()=>rulesScreen.style.display="none";

btnCrear.onclick=()=>{
  mainMenu.style.display="none";
  createScreen.style.display="block";
};

createBtn.onclick=()=>{
  if(!qText.value||!aText.value||!bText.value)return;
  db.ref("preguntas").push({
    q:qText.value,
    a:aText.value,
    b:bText.value,
    votes:{a:0,b:0}
  });
  qText.value=aText.value=bText.value="";
  createScreen.style.display="none";
  mainMenu.style.display="flex";
};

backMenu.onclick=()=>{
  endScreen.style.display="none";
  mainMenu.style.display="flex";
};
</script>
</body>
</html>